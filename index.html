<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>N√òVA Market</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #1c1c1c);
            --text-color: var(--tg-theme-text-color, #ffffff);
            --hint-color: var(--tg-theme-hint-color, #aaaaaa);
            --button-color: var(--tg-theme-button-color, #3390ec);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #2b2b2b);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color); color: var(--text-color);
            margin: 0; padding: 15px; box-sizing: border-box;
            padding-bottom: 90px;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--secondary-bg); display: flex;
            justify-content: space-around; padding: 12px 0;
            border-top: 1px solid rgba(255,255,255,0.05); z-index: 100;
        }
        .nav-item { text-align: center; font-size: 11px; color: var(--hint-color); flex: 1; cursor: pointer; }
        .nav-item.active { color: var(--button-color); }
        .nav-item-icon { font-size: 22px; margin-bottom: 3px; }

        /* –°–µ–∫—Ü–∏–∏ */
        .page { display: none; }
        .page.active { display: block; }

        header { text-align: center; margin-bottom: 15px; font-weight: 800; text-transform: uppercase; }
        header span { color: var(--button-color); }

        /* –ü—Ä–æ—Ñ–∏–ª—å */
        .profile-card {
            background: var(--secondary-bg); border-radius: 15px; padding: 20px;
            text-align: center; margin-bottom: 15px;
        }
        .user-avatar { width: 65px; height: 65px; background: var(--button-color); border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: bold; }
        .balance-box { font-size: 26px; font-weight: 800; margin: 15px 0; color: #34c759; }
        
        .deposit-btn {
            background: var(--button-color); color: #fff; border: none;
            padding: 12px 25px; border-radius: 10px; font-weight: 600;
            width: 100%; margin-top: 10px; font-size: 15px;
        }

        .user-info-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
        .user-info-row span:last-child { color: var(--hint-color); }

        /* –ú–∞—Ä–∫–µ—Ç */
        .search-container { margin-bottom: 15px; }
        #shop-search { width: 100%; padding: 12px; border-radius: 10px; border: none; background: var(--secondary-bg); color: var(--text-color); outline: none; }
        .grid-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .shop-card { background: var(--secondary-bg); border-radius: 12px; padding: 15px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.05); }
        .shop-logo { font-size: 32px; margin-bottom: 5px; }
        .shop-title { font-weight: 600; font-size: 13px; margin-bottom: 5px; }
        .tag { font-size: 9px; padding: 2px 6px; border-radius: 6px; font-weight: 700; text-transform: uppercase; background: rgba(52, 199, 89, 0.1); color: #34c759; }
    </style>
</head>
<body>

    <div id="market-page" class="page active">
        <header>N√òVA <span>MARKET</span></header>
        <div class="search-container">
            <input type="text" id="shop-search" placeholder="–ü–æ–∏—Å–∫ –º–∞–≥–∞–∑–∏–Ω–∞..." oninput="filterShops()">
        </div>
        <div id="shop-grid" class="grid-container"></div>
    </div>

    <div id="profile-page" class="page">
        <header>–í–ê–® <span>–ü–†–û–§–ò–õ–¨</span></header>
        <div class="profile-card">
            <div class="user-avatar" id="avatar-initial">?</div>
            <h3 id="user-full-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
            <div class="balance-box" id="user-balance">0.00 $</div>
            <button class="deposit-btn" onclick="showDepositOptions()">‚ûï –ü–û–ü–û–õ–ù–ò–¢–¨</button>
        </div>
        <div class="profile-card" style="padding: 5px 20px;">
            <div class="user-info-row"><span>ID:</span><span id="user-id">0</span></div>
            <div class="user-info-row"><span>–°—Ç–∞—Ç—É—Å:</span><span>Client</span></div>
            <div class="user-info-row"><span>–†–µ–≥–∏–æ–Ω:</span><span>EU / LV</span></div>
        </div>
    </div>

    <div class="bottom-nav">
        <div id="nav-market" class="nav-item active" onclick="showPage('market')">
            <div class="nav-item-icon">üõí</div>–ú–∞—Ä–∫–µ—Ç
        </div>
        <div id="nav-profile" class="nav-item" onclick="showPage('profile')">
            <div class="nav-item-icon">üë§</div>–ü—Ä–æ—Ñ–∏–ª—å
        </div>
    </div>

    <script>
        // --- –ù–ê–°–¢–†–û–ô–ö–ò (–ò–ó–ú–ï–ù–ò –ü–û–î –°–ï–ë–Ø) ---
        const API_URL = "https://8dc3e7413023a7.lhr.life";
        const ADMIN_USERNAME = "dvrkfox"; // –ë–µ–∑ —Å–∏–º–≤–æ–ª–∞ @

        const bots = [
            { name: "AX1 Premium", username: "Only1AXts_bot", icon: "üíé", tag: "Premium" },
            { name: "Narvesen Shop", username: "narvesen05bot", icon: "üè™", tag: "Retail" },
            { name: "WW King", username: "WorIdWideKing_tsbot", icon: "üëë", tag: "Global" },
            { name: "UK Reserve", username: "UK_National_Reserve_tsbot", icon: "üá¨üáß", tag: "Reserve" }
        ];

        let tg = window.Telegram.WebApp;
        tg.expand();

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ —Å —Ç–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
        async function updateBalance(userId) {
            try {
                const response = await fetch(`${API_URL}/get_balance/${userId}`);
                const data = await response.json();
                document.getElementById('user-balance').innerText = data.balance.toFixed(2) + " $";
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –±–∞–ª–∞–Ω—Å–∞:", e);
                document.getElementById('user-balance').innerText = "–û—à–∏–±–∫–∞ API";
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            const user = tg.initDataUnsafe.user;
            document.getElementById('user-full-name').innerText = user.first_name;
            document.getElementById('user-id').innerText = user.id;
            document.getElementById('avatar-initial').innerText = user.first_name[0];
            updateBalance(user.id); // –°—Ä–∞–∑—É –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –±–∞–ª–∞–Ω—Å
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById(pageId + '-page').classList.add('active');
            document.getElementById('nav-' + pageId).classList.add('active');
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
        }

        function renderShops(filter = "") {
            const container = document.getElementById('shop-grid');
            container.innerHTML = "";
            bots.filter(b => b.name.toLowerCase().includes(filter.toLowerCase())).forEach(bot => {
                const card = document.createElement('div');
                card.className = 'shop-card';
                card.onclick = () => tg.openTelegramLink('https://t.me/' + bot.username);
                card.innerHTML = `<div class="shop-logo">${bot.icon}</div><div class="shop-title">${bot.name}</div><span class="tag">${bot.tag}</span>`;
                container.appendChild(card);
            });
        }

        function showDepositOptions() {
            tg.showPopup({
                title: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ',
                message: '–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:',
                buttons: [
                    {id: 'pay', type: 'default', text: '–ö—Ä–∏–ø—Ç–∞ / –ö–∞—Ä—Ç–∞'},
                    {id: 'cancel', type: 'destructive', text: '–û—Ç–º–µ–Ω–∞'}
                ]
            }, function(btnId) {
                if (btnId === 'pay') tg.openTelegramLink('https://t.me/' + ADMIN_USERNAME);
            });
        }

        function filterShops() { renderShops(document.getElementById('shop-search').value); }
        
        tg.MainButton.setText("–ü–û–î–î–ï–†–ñ–ö–ê").show().onClick(() => tg.openTelegramLink('https://t.me/' + ADMIN_USERNAME));

        renderShops();
    </script>
</body>
</html>
