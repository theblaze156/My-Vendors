<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Connection Test</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: monospace; padding: 20px; background: #fff; color: #000; }
        .box { border: 2px solid black; padding: 10px; margin-bottom: 10px; }
        .ok { background: #ccffcc; }
        .err { background: #ffcccc; }
        button { padding: 15px; width: 100%; font-size: 20px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>üõ† N√òVA DIAGNOSTIC</h1>
    
    <div id="step1" class="box">1. Telegram WebApp: ...</div>
    <div id="step2" class="box">2. User ID: ...</div>
    <div id="step3" class="box">3. Server Connection: ...</div>
    <div id="log" style="font-size: 10px; color: #555;">Logs:<br></div>

    <button onclick="location.reload()">üîÑ RELOAD</button>

    <script>
        // --- –í–°–¢–ê–í–¨ –°–Æ–î–ê –°–°–´–õ–ö–£ –ò–ó cat tunnel.log ---
        // –ü—Ä–∏–º–µ—Ä: const API_URL = "https://abc-123.lhr.life";
        const API_URL = "https://4ebe2caa485db4.lhr.life";

        const logDiv = document.getElementById('log');
        function log(text) { logDiv.innerHTML += text + "<br>"; }

        // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram
        try {
            window.Telegram.WebApp.expand();
            document.getElementById('step1').innerHTML = "1. Telegram WebApp: ‚úÖ OK";
            document.getElementById('step1').className += " ok";
        } catch (e) {
            document.getElementById('step1').innerHTML = "1. Telegram WebApp: ‚ùå FAIL";
            document.getElementById('step1').className += " err";
            log("TG Error: " + e.message);
        }

        // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Æ–∑–µ—Ä–∞
        let userId = 0;
        try {
            const user = window.Telegram.WebApp.initDataUnsafe.user;
            if (user) {
                userId = user.id;
                document.getElementById('step2').innerHTML = "2. User ID: ‚úÖ " + userId;
                document.getElementById('step2').className += " ok";
            } else {
                userId = 12345; // –¢–µ—Å—Ç–æ–≤—ã–π ID
                document.getElementById('step2').innerHTML = "2. User ID: ‚ö†Ô∏è Test Mode (12345)";
            }
        } catch (e) {
            log("User Error: " + e.message);
        }

        // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –°–µ—Ä–≤–µ—Ä–∞ (–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ)
        log("Attempting fetch to: " + API_URL);
        
        fetch(`${API_URL}/get_balance/${userId}`)
            .then(response => {
                log("Response status: " + response.status);
                return response.json();
            })
            .then(data => {
                document.getElementById('step3').innerHTML = "3. Server: ‚úÖ OK (Bal: " + data.balance + ")";
                document.getElementById('step3').className += " ok";
                log("Data received: " + JSON.stringify(data));
            })
            .catch(error => {
                document.getElementById('step3').innerHTML = "3. Server: ‚ùå FAIL";
                document.getElementById('step3').className += " err";
                log("Fetch Error: " + error.message);
                log("Check: Is tunnel running? Is URL correct?");
            });

    </script>
</body>
</html>


